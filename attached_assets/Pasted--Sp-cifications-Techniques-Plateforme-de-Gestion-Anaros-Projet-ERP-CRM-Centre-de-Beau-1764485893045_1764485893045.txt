# üì± Sp√©cifications Techniques : Plateforme de Gestion Anaros

**Projet :** ERP & CRM Centre de Beaut√© Anaros  
**Agence :** DigitalSolverLand  
**Version :** 1.0  
**Date :** 30 Novembre 2025  

---

## 1. üéØ Objectif du Projet
D√©velopper une Single Page Application (SPA) centralis√©e pour la gestion int√©grale du centre de beaut√© **Anaros**. La solution doit g√©rer la prise de rendez-vous intelligente, le suivi des employ√©s, la base de donn√©es clients et fournir des statistiques financi√®res d√©taill√©es, avec une gestion stricte des permissions via **Supabase**.

---

## 2. üèó Architecture & Stack Technique

### Backend (Serverless)
* **Plateforme :** [Supabase](https://supabase.com)
* **Base de donn√©es :** PostgreSQL.
* **Authentification :** Supabase Auth (Email/Password).
* **S√©curit√© :** Row Level Security (RLS) pour le cloisonnement des donn√©es.
* **Notifications :** Supabase Edge Functions + pg_cron (Check toutes les 5 min).
* **Stockage :** Supabase Storage (Avatars employ√©s, photos prestations si n√©cessaire).

### Frontend
* **Framework :** React.js + Vite.
* **Langage :** TypeScript (Recommand√© pour la robustesse).
* **Styling :** Tailwind CSS + Shadcn/UI (Composants modernes et accessibles).
* **Calendrier :** FullCalendar (Librairie React) - Module "Resource TimeGrid".
* **Gestion d'√©tat :** TanStack Query (React Query) pour la synchro avec Supabase.

---

## 3. üë• Gestion des R√¥les (RBAC)

La s√©curit√© est g√©r√©e via les **Policies RLS** de Supabase.

| R√¥le | Acc√®s Dashboard | Gestion Utilisateurs | Gestion Clients | Agenda Central (Vue Globale) | Agenda Perso | Configuration Prestations |
| :--- | :---: | :---: | :---: | :---: | :---: | :---: |
| **Super Admin** | ‚úÖ Complet | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |
| **Admin** | ‚úÖ Complet | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |
| **R√©ceptionniste** (Amina) | ‚ùå | ‚ùå | ‚úÖ (Cr√©ation/Modif) | ‚úÖ (Lecture/√âcriture) | ‚ùå | ‚ùå |
| **Employ√©** (Staff) | ‚ùå | ‚ùå | ‚ùå | ‚ùå | ‚úÖ (Lecture Seule) | ‚ùå |

---

## 4. üì¶ Modules Fonctionnels

### 4.1 üìä Module Dashboard (Admin Only)
* **Objectif :** Vue d'ensemble de la sant√© du business.
* **KPIs √† afficher :**
    * Chiffre d'Affaires (Jour / Mois / Ann√©e).
    * Nombre de RDV honor√©s vs Annul√©s.
* **Classement Employ√©s :** "Qui a le mieux travaill√© ?" (Bas√© sur le total en DA des prestations r√©alis√©es).
* **Top Prestations :** Les services les plus vendus (ex: "Rituel Royal" vs "Brushing").
* **Client Dor√© (Golden Client) :** Le client ayant g√©n√©r√© le plus de CA sur le mois en cours.

### 4.2 üõ† Module Utilisateurs & RH (Admin Only)
Interface pour ajouter/supprimer des comptes.
* **Champs :** Nom, Pr√©nom, Email, Mot de passe, R√¥le, Couleur (pour l'agenda).
* **Assignation des Comp√©tences :** Indispensable pour l'agenda intelligent.
    * *Exemple :* `Samira` -> Tagu√©e "Massage". `Houda` -> Tagu√©e "Coiffure".

### 4.3 üìÖ Module Agenda (C≈ìur du syst√®me)
Utilisation de **FullCalendar** avec deux vues distinctes :

**A. Vue "R√©ception" (Agenda Central) :**
* Vue "Ressources Horizontale" : Les employ√©s sont en colonnes, les heures en lignes.
* **Logique de Cr√©ation de RDV :**
    1.  S√©lection du Client (Recherche auto-compl√©tion).
    2.  S√©lection de la Prestation (ex: "Maderoth√©rapie").
    3.  **Filtrage Intelligent :** Le syst√®me ne d√©grise QUE les colonnes des employ√©s comp√©tents (ex: Saliha, Amel) et masque les coiffeuses.
    4.  Validation du cr√©neau.

**B. Vue "Employ√©" (Mobile First) :**
* L'employ√© se connecte et ne voit **que** sa propre journ√©e.
* D√©tails visibles : Nom du client, Prestation, Heure.

### 4.4 üë§ Module Client (R√©ception + Admin)
* **Fiche Client :** Nom, Pr√©nom, T√©l√©phone, Email (optionnel).
* **Historique :** Liste des pr√©c√©dents RDV et total d√©pens√©.
* **Notes :** Champ libre (ex: "Allergique √† telle huile", "Pr√©f√®re le th√© sans sucre").

### 4.5 ‚öôÔ∏è Module Param√®tres / Prestations
Interface CRUD pour g√©rer le catalogue (digitalisation des menus papiers).
* Possibilit√© d'ajouter/modifier/supprimer une prestation.
* Champs : Cat√©gorie, Nom, Prix (DA), Dur√©e estim√©e (min).

### 4.6 üîî Module Notifications
* **Trigger :** Une fonction `Edge Function` s'ex√©cute toutes les 5 ou 10 minutes.
* **Logique :** Scanne la table `appointments`. Si `start_time` == `now() + 10min`, alors envoi d'une alerte.
* **Canal :** Notification In-App (Toast) ou Push Notification (si PWA install√©e).

---

## 5. üíæ Sch√©ma de Base de Donn√©es (Supabase)

### Table `profiles` (Extension de auth.users)
| Colonne | Type | Description |
| :--- | :--- | :--- |
| id | uuid | FK vers auth.users |
| first_name | text | Pr√©nom |
| last_name | text | Nom |
| role | text | 'superadmin', 'admin', 'reception', 'staff' |
| color_code | text | Hex code pour l'agenda (ex: #FF5733) |

### Table `services_categories`
| Colonne | Type | Description |
| :--- | :--- | :--- |
| id | int | PK |
| name | text | Coiffure, Onglerie, Hammam, etc. |

### Table `services` (Catalogue)
| Colonne | Type | Description |
| :--- | :--- | :--- |
| id | uuid | PK |
| category_id | int | FK vers services_categories |
| name | text | "Rituel Royal", "Brushing Courts" |
| price | int | Prix en DA |
| duration | int | Dur√©e en minutes (ex: 60) |

### Table `staff_skills` (Liaison Employ√©-Service)
*Permet de savoir qui sait faire quoi.*
| Colonne | Type | Description |
| :--- | :--- | :--- |
| profile_id | uuid | L'employ√© |
| category_id | int | La cat√©gorie qu'il ma√Ætrise |

### Table `clients`
| Colonne | Type | Description |
| :--- | :--- | :--- |
| id | uuid | PK |
| full_name | text | Nom complet |
| phone | text | Index√© pour recherche rapide |
| notes | text | Remarques |

### Table `appointments` (Rendez-vous)
| Colonne | Type | Description |
| :--- | :--- | :--- |
| id | uuid | PK |
| created_at | timestamp | Date de cr√©ation |
| start_time | timestamp | D√©but du RDV |
| end_time | timestamp | Fin du RDV (calcul√© via duration) |
| client_id | uuid | FK Client |
| staff_id | uuid | FK Profile (Employ√©) |
| service_id | uuid | FK Service |
| status | text | 'pending', 'confirmed', 'completed', 'cancelled' |

---

## 6. üìù Donn√©es Initiales (√Ä injecter)

### √âquipe (Staff)
* **Onglerie :** Dounia, Safa, Chahinez
* **Massage :** Samira
* **Hammam :** Marie
* **Coiffure :** Samira Samou (Coupe), Malika (Coloration), Kiki (Soins), Houda (Brushing), Karima (Balayage)
* **Maquillage :** Sara
* **Soins Visage/√âpilation :** Saliha, Amel
* **R√©ception :** Amina

### Exemple Catalogue (Extrait des images)
* **Coiffure :**
    * Cheveux courts : 1000 DA
    * Cheveux Mi-longs : 1500 DA
    * Botox √† partir de : 15000 DA
    * Balayage Cheveux courts : 15000 DA
* **Hammam :**
    * Rituel Traditionnel : 2800 DA
    * Rituel Royal : 3800 DA
    * Rituel Sultana : 7000 DA
* **Onglerie :**
    * Vernis semi permanent mains : 3000 DA
    * Gel mains : 3500 DA
    * P√©dicure Thuya : 4500 DA
* **Massage :**
    * Massage anti-stress : 6500 DA
    * Massage relaxant : 5000 DA
    * Mad√©roth√©rapie : 10000 DA
* **Soins Visage :**
    * Soin marin aux 3 algues : 6000 DA
    * Hydrafacial Hydraskin coreen : 15000 DA

---